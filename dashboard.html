<!DOCTYPE html>
<html lang="en">
<head>
  <title>Dashboard Produk</title>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>
</head>
<body>
  <h1>Dashboard Produk</h1>
  <div>
    <h2>Tambah Produk</h2>
    <form id="add-product-form">
      <input type="text" id="product-name" placeholder="Nama Produk" required />
      <input type="number" id="product-price" placeholder="Harga Produk" required />
      <input type="url" id="product-image" placeholder="URL Gambar Produk" required />
      <input type="number" id="product-stock" placeholder="Jumlah Stok" required />
      <button type="submit">Tambah Produk</button>
    </form>
  </div>

  <div>
    <h2>Daftar Produk</h2>
    <table>
      <thead>
        <tr>
          <th>Nama</th>
          <th>Harga</th>
          <th>Gambar</th>
          <th>Stok</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody id="product-table"></tbody>
    </table>
  </div>
  <script>
  const productTable = document.getElementById('product-table');

  function fetchProducts() {
    productTable.innerHTML = ''; // Clear tabel dulu
    db.collection('products').get().then(snapshot => {
      snapshot.docs.forEach(doc => {
        const product = doc.data();
        const productRow = `
          <tr>
            <td>${product.name}</td>
            <td>Rp ${product.price}</td>
            <td><img src="${product.image}" alt="${product.name}" width="50"></td>
            <td>${product.stock}</td>
            <td>
              <button onclick="editProduct('${doc.id}', '${product.name}', '${product.price}', '${product.image}', '${product.stock}')">Edit</button>
              <button onclick="deleteProduct('${doc.id}')">Hapus</button>
            </td>
          </tr>
        `;
        productTable.innerHTML += productRow;
      });
    });
  }
  fetchProducts();
</script>
<script>
  const addProductForm = document.getElementById('add-product-form');

  addProductForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const name = document.getElementById('product-name').value;
    const price = parseInt(document.getElementById('product-price').value);
    const image = document.getElementById('product-image').value;
    const stock = parseInt(document.getElementById('product-stock').value);

    db.collection('products').add({ name, price, image, stock })
      .then(() => {
        alert('Produk berhasil ditambahkan!');
        addProductForm.reset();
        fetchProducts();
      })
      .catch(err => console.error('Error adding product:', err));
  });
</script>
<script>
  function editProduct(id, name, price, image, stock) {
    document.getElementById('product-name').value = name;
    document.getElementById('product-price').value = price;
    document.getElementById('product-image').value = image;
    document.getElementById('product-stock').value = stock;

    addProductForm.onsubmit = (e) => {
      e.preventDefault();
      const updatedName = document.getElementById('product-name').value;
      const updatedPrice = parseInt(document.getElementById('product-price').value);
      const updatedImage = document.getElementById('product-image').value;
      const updatedStock = parseInt(document.getElementById('product-stock').value);

      db.collection('products').doc(id).update({ 
        name: updatedName, 
        price: updatedPrice, 
        image: updatedImage, 
        stock: updatedStock 
      }).then(() => {
        alert('Produk berhasil diupdate!');
        addProductForm.reset();
        fetchProducts();
        addProductForm.onsubmit = null; // Reset onsubmit ke default tambah produk
      });
    };
  }
</script>
<script>
  function deleteProduct(id) {
    if (confirm('Yakin mau hapus produk ini?')) {
      db.collection('products').doc(id).delete()
        .then(() => {
          alert('Produk berhasil dihapus!');
          fetchProducts();
        })
        .catch(err => console.error('Error deleting product:', err));
    }
  }
</script>

</body>
</html>
